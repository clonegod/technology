# 分布式环境的特点
分布式系统架构是基于多个硬件设备以及多个软件组成的，并且是分布在不同网络上组成的一个系统架构。

网络上的节点是通过消息传递进行通信和协调的。

严格来说一个分布式节点在空间上的部署是任意的，整个网络架构中的节点可以分布在不同的机柜，不同的IDC机房，甚至在不同的城市（异地多活）。

####分布性
组成分布式架构的节点和计算机硬件可以在空间上部署到任意的位置和地点。
随着业务的不断发展，可能增加新的节点，或者新的IDC机房，这些新增的节点可以部署在不同的网络位置。

####并发性
程序运行过程中，并发性操作是很常见的。
比如同一个分布式系统中的多个节点，同时访问一个共享资源。
比如分布式系统的多个节点同时访问数据库，同时访问分布式存储，此时就会产生并发。

####无序性
进程之间的消息通信，会出现顺序不一致问题。

---
## 分布式系统所带来的问题

分布式系统是一个硬件或软件组件分布在不同的网络计算机上，彼此之间通过消息传递进行通信和协调的系统。可以将不同的业务模块，数据进行水平切分部署。分布式意味着可以采用更多的普通计算机（相对于昂贵的大型机）组成分布式集群对外提供服务。计算机越多，CPU、内存、存储资源等也就越多，能够处理的并发访问量也就越大。

分布式因为网络的不确定性，节点故障等情况，会带来各种复杂的问题。我们在学习分布式的相关理论时，一定要明确这样一个道理，就是：网络不可靠，网络分区以及节点宕机是常态，另外网络带宽资源是及其珍贵的，我们必须在网络不可靠、分区以及节点宕机的前提下，构建高性能、高可用的分布式系统。

#分布式环境下面临的问题
####1、网络通信不可靠
网络本身的不可靠性，因此会涉及到一些网络通信问题。
当网络通信设备故障就会导致无法顺利完成一次网络通信，就算各节点的网络通信正常，但是消息丢失和消息延时也是非常普遍的事情。

####2、网络分区(脑裂)
当网络发生异常导致分布式系统中部分节点之间的网络延时不断增大，最终导致组成分布式架构的所有节点，只有部分节点能够正常通信。

如果发生网络分区（部分节点处于另一个网络环境中，无法连通），那么集群环境中将出现多个MASTER节点（不同分区各自进行自动选举MASTER），此时分区后的每个MASTER依然处于服务状态，这样就会导致整个集群环境的数据出现不一致！

当网络分区出现时，分布式系统会出现多个局部小集群（多个小集群可能又会产生多个master节点），所以分布式系统要求这些小集群要能独立完成原本需要整个分布式系统才能完成的功能，这就对分布式一致性提出了非常大的挑战。

####3、分布式环境下的三态
在分布式架构里面，除了成功、失败，还有一个特殊的状态：“超时”。
超时是分布式系统架构中特有的状态。

在集中式单机部署中，由于没有网络因素，所以程序的每一次调用都能得到“成功”或者“失败”的响应，但是在分布式系统中，网络不可靠，可能就会出现超时的情况。可能在消息发送时丢失或者在响应过程中丢失，当出现超时情况时，网络通信的发起方是无法确定当前请求是否被成功处理的，所以这也是分布式事务的难点。

####4、分布式事务
ACID(原子性、一致性、隔离性、持久性)
分布式系统中的事务需要依赖第三方软件来实现。

分布式事务是指事务的参与者、支持事务的服务器、资源服务器以及事务管理器分别位于分布式系统的不同节点上。通常一个分布式事务会涉及对多个数据源或者业务系统的操作。

----


# 中心化和去中心化
#### 1、中心化的思想
系统中存在一个领导角色，以该领导为中心，由它来负责所有任务的分配与执行。
如果领导宕机，则换一个新的领导来顶替它，并完成同样的工作。
比如，冷备或者热备的设计就是中心化思想的体现。
冷备：需要手动切换。
热备：自动切换。系统中同时存在两个以上的领导，但只有一个领导处于服务状态，一旦这个领导宕机，从预备领导中的某个顶替。比如，Mysql数据库中Master宕机，将Slave节点提升为Master节点的设计，就属于中心化的思想。

###### 中心化思想设计的系统存在的问题：
当领导下所管理的节点越来越多，将会增加领导的负载压力，此时领导的工作效率会严重降低。

#### 2、去中心化的思想---重点
集群系统中没有领导者角色，每个节点的身份都是相同的。
任何一个节点出现问题，集群仍然能够正常工作，并对外提供正常的服务。

去中心化思想设计的系统存在的问题：`网络分区/脑裂`

###### 去中心化系统设计常用的方案-自动选主

分布式架构里面，很多的架构思想采用的是：当集群发生故障的时候，集群中的人群会自动“选举”出一个新的领导。

最典型的是： zookeeper / etcd